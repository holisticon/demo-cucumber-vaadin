package de.dlh.lht.wd.base.bpm.client.pageobject;

import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;


public class LoginPage extends VaadinPageObject {

    public LoginPage(WebDriver driver) {
        super(driver);
    }

    public String getTitle() {
        return title().getText();
    }

    private WebElement title() {
        return driver().findElement(By.xpath("//*[@id='dedlhlhtwdbasebpmclient-228995731']/div/div[2]/div/div[1]/div/div/div/div[1]/div/div"));
    }

    public MainPage loginAs(String username, String password) {
        
        driver().switchTo().frame(loginFrame());
        
        WebElement usernameText = driver().findElement(By.name("username"));
        WebElement passwordText = driver().findElement(By.name("password"));

        setText(usernameText, username);
        setText(passwordText, password);

        passwordText.submit();

        driver().switchTo().defaultContent();
        
        if (not(displaysLoginFailure())) {
            return new MainPage(driver());
        }
        else {
            throw new IllegalStateException();
        }

    }

    private boolean displaysLoginFailure() {
        return driver().getPageSource().contains("<h1>Login fehlgeschlagen!</h1><p>Unbekannter Benutzer oder falsches Passwort.</p>");
    }

    private WebElement loginFrame() {
        return driver().findElement(By.name("PID7"));
    }

    protected List<WebElement> allTreeItems() {
        List<WebElement> items = driver().findElements(By.className("v-tree-node"));
        return items;
    }

}
